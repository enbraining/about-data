# About SOP

브라우저는 쿠키를 브라우저 내부에 보관합니다. 그리고 이용자가 웹 서비스에 접속할 때, 브라우저는 해당 웹 서비스에서 사용하는 인증 정보인 쿠키를 HTTP 요청에 포함시켜 전달합니다. 이와 같은 특징은 사이트에 직접 접속하는 것에만 한정되지 않습니다. 브라우저는 웹 리소스를 통해 간접적으로 타 사이트에 접근할 때도 인증 정보인 쿠키를 함께 전송하는 특징을 가지고 있습니다.

이 특징 때문에 악의적인 페이지가 클라이언트의 권한을 이용해 대상 사이트에 HTTP 요청을 보내고, HTTP 응답 정보를 획득 하는 코드를 실행할 수 있습니다. 이는 정보 유출과 같은 보안 위협이 생길 수 있는 요소가 됩니다. 따라서, 클라이언트 입장에서는 가져온 데이터를 악의적인 페이지에서 읽을 수 없도록 해야 합니다. 이것이 바로 브라우저의 보안 메커니즘인 동일 출처 정책 (Same Origin Policy, SOP) 입니다.

브라우저는 쿠키를 브라우저 내부에 보관한다. 또한 브라우저는 이용자가 웹 서비스에 접속할 때, 쿠키를 HTTP 요청에 포함시켜서 전달한다. 이는 사이트에 접속할 때만 해당하는 것이 아니라 웹 리소스를 통해 타 사이트에 접근할 때도 쿠키를 전송한다.

이러한 특징으로 악의적인 페이지에서 클라이언트의 권한을 이용해 대상 사이트에 HTTP 요청을 보내 HTTP 응답 정보를 획득할 수 있다. 이러한 악용을 막기 위해서 Same Origin Policy (SOP)라는 동일 출처 정책 매커니즘이 실행된다.

# SOP가 오리진을 구분하는 방법

브라우저가 가져온 정보를 Origin이라고 하며, Origin은 Protocol, Port, Host로 구분된다. 하나라도 다르면 Cross Origin으로 판명된다. 모든 구성요소가 같다면 Same Origin으로 판명된다.

# Cross Origin Resource Sharing

SOP에도 예외적으로 접근을 허용해줄 때가 있다. 예로 이미지나 CSS를 불러오는 ```<img> <style> <script>``` 등은 SOP의 영향을 받지 않는다. 위의 경우들 외에도 웹 서비스에서 동일 출처 정책인 SOP를 완화하여 다른 출처의 데이터를 처리 해야 하는 경우도 있다. 예를 들어 특정 포털 사이트가 카페, 블로그, 메일 서비스를 아래의 주소로 운영하고 있다고 하고, 각 서비스의 Host가 다르기 때문에 브라우저는 각 사이트의 오리진이 다르다고 인식합니다.

카페: https://cafe.dreamhack.io

블로그: https://blog.dreamhack.io

메일: https://mail.dreamhack.io

메인: https://dreamhack.io

이러한 환경에서, 이용자가 수신한 메일의 개수를 메인 페이지에 출력하려면, 개발자는 메인 페이지에서 메일 서비스에 관련된 리소스를 요청하도록 해야한다. 이 때, 두 사이트는 오리진이 다르므로 SOP를 적용받지 않고 리소스를 공유할 방법이 필요하다.

```
위와 같은 상황에서 자원을 공유하기 위해 사용할 수 있는 공유 방법을 교차 출처 리소스 공유 (Cross Origin Resource Sharing, CORS)라고 합니다. 교차 출처의 자원을 공유하는 방법은 CORS와 관련된 HTTP 헤더를 추가하여 전송하는 방법을 사용합니다. 이 외에도 JSON with Padding (JSONP) 방법을 통해 CORS를 대체할 수 있습니다. 이와 관련한 내용은 다음 페이지에서 자세히 다룹니다.
```
